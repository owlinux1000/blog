





































<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    
    $ make life
    
  </title>
  
  <link rel="alternate" type="application/rss+xml" href="https://owlinux1000.github.io/blog/index.xml" title="$ make life">
  
  
  <link rel="stylesheet" href="https://owlinux1000.github.io/blog/css/base.min.21688b64210142c045c9a1d930a48fc517f428060c78a3a012d71f971874c5c3.css" integrity="sha256-IWiLZCEBQsBFyaHZMKSPxRf0KAYMeKOgEtcflxh0xcM=">
  
  <meta name="generator" content="Hugo 0.53" />
</head>
<body>
  <nav class="u-background">
  <div class="u-wrapper">
    <ul class="Banner">
      <li class="Banner-item Banner-item--title">
        <a class="Banner-link u-clickable" href="https://owlinux1000.github.io/blog/">$ make life</a>
      </li>
      
      <li class="Banner-item">
        <a class="Banner-link u-clickable" href="https://owlinux1000.github.io/blog/about/">About</a>
      </li>
      
      <li class="Banner-item">
        <a class="Banner-link u-clickable" href="https://owlinux1000.github.io/blog/post/">Posts</a>
      </li>
      
      <li class="Banner-item">
        <a class="Banner-link u-clickable" href="https://owlinux1000.github.io/blog/tags/">Tags</a>
      </li>
      
      <li class="Banner-item">
        <a class="Banner-link u-clickable" href="https://owlinux1000.github.io/blog/categories/">Categories</a>
      </li>
      
      <li class="Banner-item">
        <a class="Banner-link u-clickable" href="https://owlinux1000.github.io/blog/index.xml">RSS</a>
      </li>
      
    </ul>
  </div>
</nav>
  <main>
    <div class="u-wrapper">
      <div class="u-padding">
        


<article>
  <header class="Heading">
  <h2 class="Heading-title">
    <a class="Heading-link u-clickable" href="https://owlinux1000.github.io/blog/post/predict_lcg/" rel="bookmark">線形合同法で生成される乱数値を予測する</a>
  </h2>
  
  <time datetime="2019-04-01T22:33:26&#43;09:00">
    1 April, 2019
  </time>
  
</header>
  

<h2 id="はじめに">はじめに</h2>

<p>線形合同法（LCG）とは、至極一般的かつ簡易に実装することができる乱数生成手法の1つです。先日行われたVolgaCTF 2019では、この線形合同法により生成される乱数値を予測する問題（問題名LG）が出題されました。本問題ではx0 ~ x6に相当する6つの乱数が表示され、それを元に次の値を算出する問題です。</p>

<h2 id="線形合同法">線形合同法</h2>

<p>線形合同法は、以下の式で定義されます。</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4">x1 = (a * x0 + c) % p</pre></div>
<p>このとき、x0は乱数のseed値、a, c, pがパラメータとなり適切な値を選びます。今回の問題では、x0 ~ x6までの値が与えられ、その次の値を入力するといったものでした。「a, c, pがわからないと無理じゃない？ｗ」と思ってしまったのですが、どうやら行列演算することで「a, c, p」を算出可能らしいです。</p>

<h2 id="線形合同法のパラメータの算出">線形合同法のパラメータの算出</h2>

<p>まずはじめに、各種x0 ~ x6を用いて以下の4つの行列を作成します。それらの行列式を用いて、各行列式の最大公約数(GCD)を算出します。これが、「p」に相当します。その後、(x3 - x4) と(x2 - x3)の法pにおける逆元を乗算し、再度pで割ると「a」になります。最後に、<code>(x4 - a * x3) % p</code>で割った際の剰余がcになる。以上の計算を行うコードを以下に示す。</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#408080;font-style:italic">#!/usr/bin/env python</span>
<span style="color:#408080;font-style:italic">#coding: utf-8</span>

<span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">math</span>
<span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">numpy</span> <span style="color:#008000;font-weight:bold">as</span> <span style="color:#00f;font-weight:bold">np</span>

x0 <span style="color:#666">=</span> <span style="color:#666">64302589647963933737451564</span>
x1 <span style="color:#666">=</span> <span style="color:#666">23099347408308738343740115</span>
x2 <span style="color:#666">=</span> <span style="color:#666">60779187967701597680605077</span>
x3 <span style="color:#666">=</span> <span style="color:#666">41531243105709646792416331</span>
x4 <span style="color:#666">=</span> <span style="color:#666">71461317334046189800115379</span>
x5 <span style="color:#666">=</span> <span style="color:#666">50094315434186546595562390</span>
x6 <span style="color:#666">=</span> <span style="color:#666">27719142972686291997765807</span>

<span style="color:#408080;font-style:italic"># なんかnp.linalg.detがエラー吐くので作成</span>
<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">det</span>(matrix):
    <span style="color:#008000;font-weight:bold">return</span> matrix[<span style="color:#666">0</span>][<span style="color:#666">0</span>] <span style="color:#666">*</span> matrix[<span style="color:#666">1</span>][<span style="color:#666">1</span>] <span style="color:#666">-</span> matrix[<span style="color:#666">0</span>][<span style="color:#666">1</span>] <span style="color:#666">*</span> matrix[<span style="color:#666">1</span>][<span style="color:#666">0</span>]

<span style="color:#408080;font-style:italic"># https://stackoverflow.com/questions/4798654/modular-multiplicative-inverse-function-in-python</span>
<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">egcd</span>(a, b):
    <span style="color:#008000;font-weight:bold">if</span> a <span style="color:#666">==</span> <span style="color:#666">0</span>:
        <span style="color:#008000;font-weight:bold">return</span> (b, <span style="color:#666">0</span>, <span style="color:#666">1</span>)
    <span style="color:#008000;font-weight:bold">else</span>:
        g, y, x <span style="color:#666">=</span> egcd(b <span style="color:#666">%</span> a, a)
        <span style="color:#008000;font-weight:bold">return</span> (g, x <span style="color:#666">-</span> (b <span style="color:#666">//</span> a) <span style="color:#666">*</span> y, y)
<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">modinv</span>(a, m):
    g, x, y <span style="color:#666">=</span> egcd(a, m)
    <span style="color:#008000;font-weight:bold">if</span> g <span style="color:#666">!=</span> <span style="color:#666">1</span>:
        <span style="color:#008000;font-weight:bold">raise</span> <span style="color:#d2413a;font-weight:bold">Exception</span>(<span style="color:#ba2121">&#39;modular inverse does not exist&#39;</span>)
    <span style="color:#008000;font-weight:bold">else</span>:
        <span style="color:#008000;font-weight:bold">return</span> x <span style="color:#666">%</span> m

matrix0 <span style="color:#666">=</span> np<span style="color:#666">.</span>array([
    [x1 <span style="color:#666">-</span> x0, x2 <span style="color:#666">-</span> x1],
    [x2 <span style="color:#666">-</span> x0, x3 <span style="color:#666">-</span> x1]
])

matrix1 <span style="color:#666">=</span> np<span style="color:#666">.</span>array([
    [x2 <span style="color:#666">-</span> x0, x3 <span style="color:#666">-</span> x1],
    [x3 <span style="color:#666">-</span> x0, x4 <span style="color:#666">-</span> x1]
])

matrix2 <span style="color:#666">=</span> np<span style="color:#666">.</span>array([
    [x3 <span style="color:#666">-</span> x0, x4 <span style="color:#666">-</span> x1],
    [x4 <span style="color:#666">-</span> x0, x5 <span style="color:#666">-</span> x1]
])

matrix3 <span style="color:#666">=</span> np<span style="color:#666">.</span>array([
    [x4 <span style="color:#666">-</span> x0, x5 <span style="color:#666">-</span> x1],
    [x5 <span style="color:#666">-</span> x0, x6 <span style="color:#666">-</span> x1]
])

p0 <span style="color:#666">=</span> math<span style="color:#666">.</span>gcd(det(matrix0), det(matrix1))
p1 <span style="color:#666">=</span> math<span style="color:#666">.</span>gcd(p0, det(matrix2))
p <span style="color:#666">=</span> math<span style="color:#666">.</span>gcd(p1, det(matrix3))

a <span style="color:#666">=</span> ((x3 <span style="color:#666">-</span> x4) <span style="color:#666">*</span> modinv(x2 <span style="color:#666">-</span> x3, p)) <span style="color:#666">%</span> p
c <span style="color:#666">=</span> (x4 <span style="color:#666">-</span> a <span style="color:#666">*</span> x3) <span style="color:#666">%</span> p

<span style="color:#008000;font-weight:bold">assert</span> x1 <span style="color:#666">==</span> (a <span style="color:#666">*</span> x0 <span style="color:#666">+</span> c) <span style="color:#666">%</span> p, <span style="color:#ba2121">&#34;Not eqaul&#34;</span>
<span style="color:#008000;font-weight:bold">assert</span> x2 <span style="color:#666">==</span> (a <span style="color:#666">*</span> x1 <span style="color:#666">+</span> c) <span style="color:#666">%</span> p, <span style="color:#ba2121">&#34;Not eqaul&#34;</span>
<span style="color:#008000;font-weight:bold">assert</span> x3 <span style="color:#666">==</span> (a <span style="color:#666">*</span> x2 <span style="color:#666">+</span> c) <span style="color:#666">%</span> p, <span style="color:#ba2121">&#34;Not eqaul&#34;</span>
<span style="color:#008000;font-weight:bold">assert</span> x4 <span style="color:#666">==</span> (a <span style="color:#666">*</span> x3 <span style="color:#666">+</span> c) <span style="color:#666">%</span> p, <span style="color:#ba2121">&#34;Not eqaul&#34;</span>
<span style="color:#008000;font-weight:bold">assert</span> x5 <span style="color:#666">==</span> (a <span style="color:#666">*</span> x4 <span style="color:#666">+</span> c) <span style="color:#666">%</span> p, <span style="color:#ba2121">&#34;Not eqaul&#34;</span>
<span style="color:#008000;font-weight:bold">assert</span> x6 <span style="color:#666">==</span> (a <span style="color:#666">*</span> x5 <span style="color:#666">+</span> c) <span style="color:#666">%</span> p, <span style="color:#ba2121">&#34;Not eqaul&#34;</span>
<span style="color:#008000;font-weight:bold">print</span>((a <span style="color:#666">*</span> x6 <span style="color:#666">+</span> c) <span style="color:#666">%</span> p) <span style="color:#408080;font-style:italic">#=&gt; 54571278391299526410540376</span></code></pre></div>
<h2 id="おわりに">おわりに</h2>

<p>本記事では、線形合同法における乱数値の予測方法についてまとめた。パラメータが不明な場合でも本手法を用いることで解読なので覚えておきたい。</p>

  
</article>

<article>
  <header class="Heading">
  <h2 class="Heading-title">
    <a class="Heading-link u-clickable" href="https://owlinux1000.github.io/blog/post/pragyan2019/" rel="bookmark">PragyanCTF 2019 writeup</a>
  </h2>
  
  <time datetime="2019-03-10T22:48:37&#43;09:00">
    10 March, 2019
  </time>
  
</header>
  

<h2 id="welcome">Welcome</h2>

<ul>
<li>JPEGが渡されるが、binwalkをかけると中にzipがあるので取り出す</li>
<li>取り出したzipを展開すると壊れたbmpとパスワード付きのzipが展開される</li>
<li>bmpファイルの末尾にはbase64エンコードされたような文字列があるのでデコードするとzipのパスワード</li>
<li>zipを展開するとpngファイルがでてくる</li>
<li>stegosolveで適当にぽちぽちやるとFLAG</li>
<li><code>pctf{st3gs0lv3_1s_u53ful}</code></li>
</ul>

<h2 id="cookie-monster">Cookie Monster</h2>

<ul>
<li>Cookieにflagというフィールドがあり、MD5が設定されている</li>
<li>どこかのMD5クラックサイトで検索すると<code>pc</code>がでてくる</li>
<li>フラグフォーマットは、<code>pctf{</code>なのでひたすらこのCookieのMD5の元を考えれば良いとわかる</li>
<li><code>pctf{c0oki3s_@re_yUm_bUt_tHEy_@ls0_r3vEaL_@_l0t}</code></li>
</ul>

<h2 id="feed-me">Feed_me</h2>

<ul>
<li>バイナリを読むと、渡された乱数3つがチェック用の値になっている</li>
<li>入力文字列を10byteずつ分割してatoiに流し込んでいて、以下の式が成り立てばおｋなので、あとは算数
<code>
x + y = a1
y + z = a2
x + z = a3
</code></li>
<li>自分が解いたときのケース
<code>
Can you cook my favourite food using these ingredients :)
-10026 ; -8250 ; -12490 ;
-000007133-000002893-000005357
That's yummy.... Here is your gift:
pctf{p1zz4_t0pp3d_w1th_p1n34ppl3_s4uc3}
</code></li>
</ul>

<h2 id="game-of-faces">Game of Faces</h2>

<ul>
<li>ページにアクセスすると3色のよくわからん正方形があるが、ソースを見るとファイルアップロードが見える</li>
<li>適当にファイルをアップロードするとh1タグでbase64エンコードされた文字列が帰ってくるのでデコードするとファイル名がわかる</li>
<li>ファイル名で直接アクセスするとフラグ</li>
<li><code>pctf{You_L00K_Wi3Rd_IN_H3R3}</code></li>
</ul>

<h2 id="easy-rsa">Easy RSA</h2>

<ul>
<li>e, c, nのパラメータが渡されるが、eが著しく大きいので、Wiener&rsquo;s Attackだとわかる</li>
<li>コード書いて、秘密鍵dを計算すると<code>12978409760901509356642421072925801006324287746872153539187221529835976408177</code>だとわかる</li>
<li>あとは普通にRSAを解読したら、出てきた数値を16進数表記にして1byteずつasciiにすればフラグ</li>
<li><code>pctf{Sup3r_st4nd4rd_W31n3r_4tt4ck}</code></li>
</ul>

<h2 id="late-pr">Late PR</h2>

<ul>
<li>課題を提出しようとしてたけどパソコンがクラッシュしたという問題文とともにイメージファイルが渡される</li>
<li>vol.pyでプロセスを見るとchrome.exeがexitしていることがわかり、GoogleChromeCrashHandler.exeというプロセスの存在に気づくので、当該プロセスのメモリダンプを見てみるとフラグ

<ul>
<li><code>vol.py -f *.raw --profile Win7SP1x86_23418 pslist</code></li>
<li><code>vol.py -f *.raw --profile Win7SP1x86_23418 memdump --dump-dir .</code></li>
<li><code>strings 468.dmp | grep pctf</code></li>
</ul></li>
<li><code>pctf{Late_submissions_can_be_good}</code></li>
</ul>

<h2 id="mandatory-php">Mandatory PHP</h2>

<ul>
<li>以下のPHPのコードが渡される</li>
</ul>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#bc7a00">&lt;?php</span> 
<span style="color:#008000;font-weight:bold">include</span> <span style="color:#ba2121">&#39;flag.php&#39;</span>; 
highlight_file(<span style="color:#ba2121">&#39;index.php&#39;</span>); 
<span style="color:#19177c">$a</span> <span style="color:#666">=</span> <span style="color:#19177c">$_GET</span>[<span style="color:#ba2121">&#34;val1&#34;</span>]; 
<span style="color:#19177c">$b</span> <span style="color:#666">=</span> <span style="color:#19177c">$_GET</span>[<span style="color:#ba2121">&#34;val2&#34;</span>]; 
<span style="color:#19177c">$c</span> <span style="color:#666">=</span> <span style="color:#19177c">$_GET</span>[<span style="color:#ba2121">&#34;val3&#34;</span>]; 
<span style="color:#19177c">$d</span> <span style="color:#666">=</span> <span style="color:#19177c">$_GET</span>[<span style="color:#ba2121">&#34;val4&#34;</span>]; 
<span style="color:#008000;font-weight:bold">if</span>(preg_match(<span style="color:#ba2121">&#39;/[^A-Za-z]/&#39;</span>, <span style="color:#19177c">$a</span>)) 
<span style="color:#008000;font-weight:bold">die</span>(<span style="color:#ba2121">&#39;oh my gawd...&#39;</span>); 
<span style="color:#19177c">$a</span><span style="color:#666">=</span>hash(<span style="color:#ba2121">&#34;sha256&#34;</span>,<span style="color:#19177c">$a</span>); 
<span style="color:#19177c">$a</span><span style="color:#666">=</span>(log10(<span style="color:#19177c">$a</span><span style="color:#666">**</span>(<span style="color:#666">0.5</span>)))<span style="color:#666">**</span><span style="color:#666">2</span>; 
<span style="color:#008000;font-weight:bold">if</span>(<span style="color:#19177c">$c</span><span style="color:#666">&gt;</span><span style="color:#666">0</span><span style="color:#666">&amp;&amp;</span><span style="color:#19177c">$d</span><span style="color:#666">&gt;</span><span style="color:#666">0</span><span style="color:#666">&amp;&amp;</span><span style="color:#19177c">$d</span><span style="color:#666">&gt;</span><span style="color:#19177c">$c</span><span style="color:#666">&amp;&amp;</span><span style="color:#19177c">$a</span><span style="color:#666">==</span><span style="color:#19177c">$c</span><span style="color:#666">*</span><span style="color:#19177c">$c</span><span style="color:#666">+</span><span style="color:#19177c">$d</span><span style="color:#666">*</span><span style="color:#19177c">$d</span>) 
<span style="color:#19177c">$s1</span><span style="color:#666">=</span><span style="color:#ba2121">&#34;true&#34;</span>; 
<span style="color:#008000;font-weight:bold">else</span> 
    <span style="color:#008000;font-weight:bold">die</span>(<span style="color:#ba2121">&#34;Bye...&#34;</span>); 
<span style="color:#008000;font-weight:bold">if</span>(<span style="color:#19177c">$s1</span><span style="color:#666">===</span><span style="color:#ba2121">&#34;true&#34;</span>) 
    <span style="color:#008000;font-weight:bold">echo</span> <span style="color:#19177c">$flag1</span>; 
<span style="color:#008000;font-weight:bold">for</span>(<span style="color:#19177c">$i</span><span style="color:#666">=</span><span style="color:#666">1</span>;<span style="color:#19177c">$i</span><span style="color:#666">&lt;=</span><span style="color:#666">10</span>;<span style="color:#19177c">$i</span><span style="color:#666">++</span>){ 
    <span style="color:#008000;font-weight:bold">if</span>(<span style="color:#19177c">$b</span><span style="color:#666">==</span>urldecode(<span style="color:#19177c">$b</span>)) 
        <span style="color:#008000;font-weight:bold">die</span>(<span style="color:#ba2121">&#39;duck&#39;</span>); 
    <span style="color:#008000;font-weight:bold">else</span> 
        <span style="color:#19177c">$b</span><span style="color:#666">=</span>urldecode(<span style="color:#19177c">$b</span>); 
}     
<span style="color:#008000;font-weight:bold">if</span>(<span style="color:#19177c">$b</span><span style="color:#666">===</span><span style="color:#ba2121">&#34;WoAHh!&#34;</span>) 
<span style="color:#19177c">$s2</span><span style="color:#666">=</span><span style="color:#ba2121">&#34;true&#34;</span>; 
<span style="color:#008000;font-weight:bold">else</span> 
    <span style="color:#008000;font-weight:bold">die</span>(<span style="color:#ba2121">&#39;oops..&#39;</span>); 
<span style="color:#008000;font-weight:bold">if</span>(<span style="color:#19177c">$s2</span><span style="color:#666">===</span><span style="color:#ba2121">&#34;true&#34;</span>) 
    <span style="color:#008000;font-weight:bold">echo</span> <span style="color:#19177c">$flag2</span>; 
<span style="color:#008000;font-weight:bold">die</span>(<span style="color:#ba2121">&#39;end...&#39;</span>); 
<span style="color:#bc7a00">?&gt;</span> 
</code></pre></div>
<ul>
<li><code>val1</code>が<code>INF</code>になるので、<code>val3</code>と<code>val4</code>でINFになるようにデカイ数を渡して、<code>val2</code>は10回urldecodeして<code>WoAHh!</code>になるようにパラメータを渡せば良い</li>
<li><code>curl 'http://159.89.166.12:14000///index.php?ffval1=0&amp;val2=WoAHh%2525252525252525252521&amp;val3=101&amp;val4=大きい値'</code></li>
<li><code>pctf{b3_c4r3fu1_w1th_pHp_f31145}</code></li>
</ul>

<h2 id="終了後に解いた問題">終了後に解いた問題</h2>

<h3 id="magic-pngs">Magic PNGs</h3>

<ul>
<li>パスワード付きzipとpngファイルが渡されるが、<code>file</code>コマンドを叩くと<code>data</code>都市てか表示されないためヘッダーなどが間違っていると推測できる</li>
<li>案の定Magic numberが間違っているので修正するが、それでも開かない</li>
<li>PNGは通常IDATチャンクがあるはずだが、そのキーワードが<code>idat</code>と小文字になっていたのでこれを修正すると開けて、<code>h4CK3RM4n</code>が読み取れる</li>
<li>ヒントから、この値をmd5してパスワードzipを展開するとフラグ</li>
<li><code>pctf{y0u_s33_m33_n0w!}</code></li>
<li><strong>ファイルヘッダーとかが違うところに気づいていなかった</strong></li>
</ul>

<h3 id="exorcism">EXORcism</h3>

<ul>
<li>大量の1と0があるファイルを渡される</li>
<li>100x100の正方形に整形して、1をスペース、0は黒として描画するとQRコードになる</li>
<li>QRコードを読み取ると、<code>160f15011d1b095339595138535f135613595e1a</code></li>
<li>タイトルがXORなので、この文字列となにかをxorする必要があると推測できる</li>
<li>フラグフォーマットの<code>pctf{</code>になるようにxorする値を計算すると<code>flagf</code>になるので、<code>flag</code>を繰り返してxorすれば良いとわかるので、それで計算するとフラグ</li>
<li><code>pctf{wh4_50_53r1u5?}</code></li>
<li><strong>そもそもQRコードになるなんて想像ができなかった</strong></li>
</ul>

<h2 id="save-earth">Save Earth</h2>

<ul>
<li>USBパケットのデータが渡されて入力した値を求めさせる</li>
<li>データ内にasciiがないので、間隔つまりモールス信号だと推測する</li>
<li>USBパケットの末尾のデータ部から4をスペース、1と2をそれぞれモールス信号にするとフラグが得られる</li>
<li><code>CTFS4V3</code></li>
</ul>

  
</article>

<article>
  <header class="Heading">
  <h2 class="Heading-title">
    <a class="Heading-link u-clickable" href="https://owlinux1000.github.io/blog/post/bsidessf2019/" rel="bookmark">BesidesCTF 2019 writeup</a>
  </h2>
  
  <time datetime="2019-03-10T22:43:52&#43;09:00">
    10 March, 2019
  </time>
  
</header>
  

<h2 id="blink">blink</h2>

<ul>
<li>apkが渡されるのでunzipして、<code>classes.dex</code>をdex2jarでjarファイルに変換</li>
<li>jarファイルをunzipして、classファイルをjadで一括逆コンパイル</li>
<li>適当にファイルを眺めていると<code>/com/example/blink/r2d2.jad</code>にbase64でエンコードされた文字列があるのでデコード</li>
<li><code>CTF{PUCKMAN}</code>と書かれた画像が出てくる</li>
</ul>

<h2 id="zippy">zippy</h2>

<ul>
<li>pcapngが渡されるのでFollo TCP Streamをすると<code>supercomplexpassword</code>がzipのパスワードだとわかる</li>
<li>パケットからzipファイルを通信してるパケットを見つけて抽出</li>
<li>パスワードを使ってunzipすると中のflag.txtに<code>CTF{this_flag_is_your_flag}</code></li>
</ul>

<h2 id="futurella">futurella</h2>

<ul>
<li>HTMLのソースを見ると<code>CTF{bring_it_back}</code></li>
</ul>

<h2 id="kookie">kookie</h2>

<ul>
<li><code>cookie/monster</code>でログインできるのでログインする</li>
<li>その際のCookieを見ると、<code>cookie</code>になっているので、これを<code>admin</code>に変更</li>
<li>その後reloadすると<code>CTF{kookie_cookies}</code></li>
</ul>

  
</article>

<article>
  <header class="Heading">
  <h2 class="Heading-title">
    <a class="Heading-link u-clickable" href="https://owlinux1000.github.io/blog/post/analyzing_binary_cookie/" rel="bookmark">binarycookiesファイル解析ツールbincookie</a>
  </h2>
  
  <time datetime="2019-03-06T23:10:49&#43;09:00">
    6 March, 2019
  </time>
  
</header>
  

<h2 id="はじめに">はじめに</h2>

<p>iOSやMacのフォレンジックでは、アーティファクトの1つとしてCookie情報を利用します。macOSでは、<code>/User/ユーザ名/Library/Cookies/Cookies.binarycookies</code> に存在します。しかしながら、本ファイルは拡張子からもわかるようにバイナリ形式になっています。そこで、本記事ではこのバイナリファイルを解析するツールをご紹介します。</p>

<h2 id="bincookie">bincookie</h2>

<p><a href="https://github.com/owlinux1000/bincookie">bincookie</a><br />
拙作のGolangで実装された解析ツールです。goユーザなら<code>go get</code>で入りますし、Releaseからバイナリのダウンロードもできます。<br />
本ツールの特徴として、<code>curl</code>コマンドで利用できる形式として出力する点です。私の手元にあった<code>/Users/ユーザ名/Library/Cookies/com.apple.iTunes.binarycookies</code>に対して適用した例が以下です。</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4">$ bincookie /Users/ユーザ名/Library/Cookies/com.apple.iTunes.binarycookies
# Netscape HTTP Cookie File
# This file was generated by owlinux1000&#39;s bincookie
# https://github.com/owlinux1000/bincookie

.apple.com	TRUE	/	TRUE	1566914111	xp_ci	hogehogehoge
.apple.com	TRUE	/	TRUE	1566914111	xp_ab	hogehogehoge
.xp.apple.com	TRUE	/	TRUE	1566914111	xp_aci	hogehogehog</pre></div>
<p>また、同様のソフトウェアとして以下の2つが存在します。</p>

<ul>
<li><a href="https://github.com/as0ler/BinaryCookieReader">BinaryCookieReader</a></li>
<li><a href="https://github.com/horrorho/burnt-cookie">Burnt Cookie</a></li>
</ul>

<h2 id="おわりに">おわりに</h2>

<p>binarycookiesファイル解析ツールbincookieの宣伝をしました。binarycookiesファイルを解析する際には、ぜひbincookie使ってみてください。バグか何かあったらissueやPR待ってます。</p>

  
<footer>
  <ul class="Tags">
    
    
    
    <li class="Tags-item u-background">
      <a class="Tags-link u-clickable" href="https://owlinux1000.github.io/blog/tags/mobile/" rel="tag">mobile</a>
    </li>
    
    
  </ul>
</footer>

</article>

<article>
  <header class="Heading">
  <h2 class="Heading-title">
    <a class="Heading-link u-clickable" href="https://owlinux1000.github.io/blog/post/an_introduction_of_ios_forensics/" rel="bookmark">iOSデバイスフォレンジック入門</a>
  </h2>
  
  <time datetime="2019-02-28T21:00:00&#43;09:00">
    28 February, 2019
  </time>
  
</header>
  

<h2 id="はじめに">はじめに</h2>

<p>本記事では、<strong>iOSフォレンジックをやったことない</strong>人向けに基本的な情報をまとめてみました。取っ掛かりとしては簡単に読める内容だと思います。主にiOSデバイスのバックアップデータやその解析ツールについてご紹介しています。</p>

<h2 id="準備">準備</h2>

<p>本記事では主に以下のデバイスやソフトウェアを使って検証しています。当該デバイスやバージョンでない場合同じ結果や解釈にならない可能性もありますのでご了承ください。</p>

<ul>
<li>iPad mini4 (iOS 12.1.1 非Jailbreak)</li>
<li>MacBookPro (High Sierra 10.13.6)</li>
<li>iTunes (12.8.3)</li>
</ul>

<h2 id="ios-概要">iOS 概要</h2>

<p>iOSは、iPhoneやiPad、Apple Watch等で利用されているOSです。iOSは大きく分けて、以下の4つのシステムから構成されています。</p>

<ul>
<li>Cocoa Touch</li>
<li>Media</li>
<li>Cocoa Service</li>
<li>Core OS</li>
</ul>

<p>Cocoa Touchは、名前からもわかるようにタッチ操作を始めとするユーザーインタフェースのシステムです。Mediaは、動画像や音楽などMedia用のシステムです。Cocoa Serviceは、アプリケーションにとって必要な基本的なシステムを提供しています。最後のCore OSは、ハードウェアに近いより低レイヤーなネットワークやメモリ管理、スレッドの機能などを提供しています。</p>

<p>次に、iOSで用いられているファイルシステムについて簡単にご紹介いたします。近年のiOSではAPFS（Apple File System）と呼ばれるファイルシステムが利用されています。従来はHFS、HFS+が使われていましたが、2017年のiOS 10.3からAPFSが導入されました。APFSの特徴としては、inodeが64bitに拡張されたためより多くのファイルが扱えるようになったり、CoW（Copy on Write）のサポート、タイムスタンプがナノ秒単位まで記録するようになったりなど従来のファイルシステムに比べ大きく変わっています。より詳細な情報としては以下のWebページなどが参考になると思います。</p>

<ul>
<li><a href="https://ja.wikipedia.org/wiki/Apple_File_System">Apple File System</a></li>
<li><a href="https://cyberforensic.focus-s.com/knowledge/articles_detail/356/">ファイルシステムがAPFSになった事による変更点</a></li>
</ul>

<h2 id="itunesバックアップ">iTunesバックアップ</h2>

<p>iOSデバイスにおけるデータを抽出する方法としては、物理と論理の2通りの方法があります。しかしながら、物理デバイスから情報を抽出するためには、機材が必要であったり、論理面でも有償のツールが必要なことが多く入門には不向きです。そこで本記事では、iTunesのバックアップデータを元にiOSデバイスのフォレンジック調査に役立つ情報をまとめていこうと思います。もしすでにホストマシンにiTunesを用いてバックアップをとっている人はそのデータをお使いできます。もしなければ、iOSデバイスを接続し、iTunesの画面よりバックアップをとってください。</p>

<p>iOSデバイスのバックアップデータは、以下の場所に格納されます。</p>

<ul>
<li>Mac：<code>/User/ユーザ名/Library/Application Support/MobileSync/Backup</code></li>
<li>Windows：<code>\AppData\Roaming\Apple Computer\MobileSync\Backup\</code></li>
<li>Windowsストアアプリ経由でiTunesを入れた場合：<code>%USERPROFILE%\Apple\MobileSync\Backup</code></li>
</ul>

<p>バックアップを行っている状態で、上記フォルダにアクセスするとハッシュ値が名前のフォルダがあると思います。それがバックアップデータの本体です。バックアップデータのフォルダの中には、主に以下のファイルやフォルダが格納されていると思います。</p>

<ul>
<li>Manifest.plist</li>
<li>Manifest.db</li>
<li>Info.plist</li>
<li>Status.plist</li>
<li>大量のフォルダ</li>
</ul>

<p>Manifest.plistは、主にバックアップの内容について記載されています。例えばバックアップした日時、バックアップを暗号化しているかどうか、インストールしたアプリケーション一覧などがあげられます。Manifest.dbは、SQLiteのデータベースファイルで、バックアップデータに含まれるファイルやフォルダの情報が格納してあります。<code>fileID</code>カラムには、SHA1が格納されており、これはファイル名を表しています。そのため、バックアップフォルダの中で、このハッシュ値を使って検索したりします。<br />
以下の図は、DB Browser for SQLiteでManifest.dbを読み込んだときの図です。CUIのsqlite3コマンドなどでも良いのですが、フォレンジック業務をやるときには、フィルターやソート、検索などが手軽に使えるほうが効率が良いので、こういったGUIツールを使っています。</p>

<p><img src="https://imgur.com/download/2PzjpVu" alt="Manifest.db" /></p>

<p>Info.plistは、主にバックアップ対象のデバイス情報について記載されています。例えば、IMEIやシリアルナンバー、最後にバックアップした日などが挙げられます。Status.plistは、主にバックアップ状況について記載されています。</p>

<p>バックアップフォルダの中に格納されている主要なアーティファクトは、SANSの公開資料の<a href="https://digital-forensics.sans.org/media/DFIR-Smartphone-Forensics-Poster.pdf">DFIR-Smartphone-Forensics-Poster.pdf</a> に掲載されています。とても便利なのでダウンロードしておくことをおすすめします。</p>

<h2 id="itunesバックアップ解析ツール">iTunesバックアップ解析ツール</h2>

<p>今まで見てきたバックアップデータなどを解析する際に役立つツールをご紹介します。</p>

<h3 id="plutil">plutil</h3>

<p>拡張子plistのバイナリファイルの中身を解析する際には、<code>plutil</code>コマンドが便利です。Macの場合は標準でインストールされているのですぐに使えます。Windowsでは、<a href="https://www.icopybot.com/plist-editor.htm">plist Editor Pro for Windows</a>というものが存在するので、それを利用できそうです（未検証）。</p>

<p>本来<code>plutil</code>コマンドはいろいろな操作ができますが、今回はフォレンジックでよく使うplistファイルを別のファイルに変換する操作をご紹介します。以下は、<code>Info.plist</code>ファイルをxmlファイルに変換する場合の例です。plistファイルはバイナリファイルなので、こういった変換を行うことが必要となってきます。</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4">$ plutil -t convert xml1 Info.plist -o Info.xml</pre></div>
<p><code>-o</code>オプションを忘れてしまうとplistファイル自体の中身が書き換わってしまうので注意してください。<br />
その他Pythonが利用できる環境であれば、<code>plistlib</code>ライブラリが利用できるので、これを用いてプログラマブルに解析することも可能です。</p>

<h3 id="iexplorer">iExplorer</h3>

<p><img src="https://imgur.com/download/Aogfu9Z" alt="iExplorer" /></p>

<p>iExplorerは、高機能なiOSデバイスファイルブラウザーです。<a href="https://macroplant.com/iexplorer">iExplorer</a> よりダウンロードできます。iExplorerは、Manifest.dbなどの情報を自動でパースし、より人間にわかりやすい形で表示してくれます。正直これがあれば、バックアップデータの閲覧には困らないと思います。全体的に眺めたい際などは、こちらを使って足りない場合、前述した<code>plutil</code>コマンドなどを使って解析します。同様のツールとして<code>iBackupBot</code>や<code>iBackup Viewer</code>などがあるので、使い比べてみて自分にあったものを使うと良いでしょう。</p>

<h2 id="おわりに">おわりに</h2>

<p>今回は、iOSの基本構造やバックアップデータを用いた解析方法などについて簡単にご紹介しました。次は、気が向けば個々のアーティファクトについてより詳細にとりあげて記事を今度書こうかなと思っています。</p>

<h2 id="参考資料">参考資料</h2>

<ul>
<li><a href="https://www.packtpub.com/networking-and-servers/practical-mobile-forensics-third-edition">Practical Mobile Forensics - Third Edition</a></li>
</ul>

  
<footer>
  <ul class="Tags">
    
    
    
    <li class="Tags-item u-background">
      <a class="Tags-link u-clickable" href="https://owlinux1000.github.io/blog/tags/mobile/" rel="tag">mobile</a>
    </li>
    
    
  </ul>
</footer>

</article>

<article>
  <header class="Heading">
  <h2 class="Heading-title">
    <a class="Heading-link u-clickable" href="https://owlinux1000.github.io/blog/post/system_time_for_forensics/" rel="bookmark">フォレンジックのためのシステム時刻入門</a>
  </h2>
  
  <time datetime="2019-02-23T20:37:24&#43;09:00">
    23 February, 2019
  </time>
  
</header>
  

<ul>
<li>フォレンジックなどをやっていると様々な時刻形式と直面することがあります。いざ調べてみると時刻形式は、プラットフォームによって異なる場合が多いことに気づきました。時刻の情報はタイムライン作成では、とても重要な要因となってくるので、適切に時刻を解釈することが必要です。本記事では、よく見る3つの時刻表記についてご紹介します。</li>
</ul>

<h2 id="unix-time">UNIX time</h2>

<ul>
<li>UNIX timeはDFIRだけに限らず多くの場面でよく見かける時刻形式の1つです。<strong>UTC（協定世界時）の1970年1月1日0時0分0秒からの経過秒数</strong>で表す時刻形式です。主要なプログラミング言語の代表的な時刻を扱うライブラリなどでは、UNIX timeをサポートしています。例えばRubyでは以下の様に、UNIX timeを扱うことができます。</li>
</ul>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#008000">require</span> <span style="color:#ba2121">&#39;time&#39;</span>
<span style="color:#800">JST_OFFSET</span> <span style="color:#666">=</span> <span style="color:#666">3600</span> <span style="color:#666">*</span> <span style="color:#666">9</span>
<span style="color:#008000">puts</span> <span style="color:#800">Time</span><span style="color:#666">.</span>parse(<span style="color:#ba2121">&#34;1970-01-01 00:00:00&#34;</span>)<span style="color:#666">.</span>to_i <span style="color:#666">+</span> <span style="color:#800">JST_OFFSET</span> <span style="color:#408080;font-style:italic">#=&gt; 0</span>
<span style="color:#008000">puts</span> <span style="color:#800">Time</span><span style="color:#666">.</span>at(<span style="color:#666">0</span>) <span style="color:#408080;font-style:italic">#=&gt; 1970-01-01 09:00:00 +0900</span></code></pre></div>
<h2 id="apple-cocoa-core-data-timestamp">Apple Cocoa Core Data timestamp</h2>

<ul>
<li>Apple Cocoa Core Data timestampは、主にMac OSやiOSで見かける時刻形式です。Cocoaとは、macOS用のフレームワークです。また、<strong>Mac absolute time</strong>と表記されることもあります。本時刻形式は、<strong>UTCの2001年1月1日0時0分0秒からの経過秒数</strong>で表す時刻形式です。UNIX timeとの差分は、<strong>978307200</strong>なので、これを考慮すればUNIX timeからすぐ算出することができます。</li>
</ul>

<h2 id="webkit-chrome-time">WebKit/Chrome time</h2>

<ul>
<li>WebKit/Chrome timeは、Google Chrome、OperaやSafariなどのデータで使われている時刻形式です。本時刻形式は、<strong>UTCの1601年1月1日0時0分0秒からの経過マイクロ秒</strong>で表す時刻形式です。UNIX timeなどと異なりマイクロ秒なので値が大きいという特徴があります。</li>
</ul>

<h2 id="便利なツールやサイト">便利なツールやサイト</h2>

<p>以下の2つは、システム時刻変換をする際に、使いやすかったツールです。</p>

<ul>
<li><a href="https://www.epochconverter.com/">Epoch Converter</a>

<ul>
<li>本記事で説明した時刻形式などは概ねカバーしているツールです</li>
</ul></li>
<li><a href="https://www.digital-detective.net/dcode/">DCode</a>

<ul>
<li>Epoch Converterと同様の機能を有しているWindowsアプリケーション</li>
</ul></li>
</ul>

<h2 id="参考文献">参考文献</h2>

<ul>
<li><a href="https://www.packtpub.com/networking-and-servers/practical-mobile-forensics-third-edition">Practical Mobile Forensics - Third Edition</a></li>
</ul>

  
</article>

<article>
  <header class="Heading">
  <h2 class="Heading-title">
    <a class="Heading-link u-clickable" href="https://owlinux1000.github.io/blog/post/helloworld/" rel="bookmark">新年なのでHugo でGitHub Pages にデプロイ</a>
  </h2>
  
  <time datetime="2019-01-02T22:27:14&#43;09:00">
    2 January, 2019
  </time>
  
</header>
  

<ul>
<li>あけましておめでとうございます。本年もよろしくお願いいたします。<br />
新年なので、Hugo で技術ブログを作成してみました。私ははてなブログやMedium などいろいろサイトを持っているわけですが、このブログには自分の備忘録的なことを書いて行こうと思います。</li>
</ul>

<h2 id="1-hugo-のインストールと事前準備">1. Hugo のインストールと事前準備</h2>

<ul>
<li><p>まずはHugo をインストールし、使いたいテーマ(今回はoneというテーマ)をsubmoduleとして取り込む。今回は、GitHub に<code>blog</code> というリポジトリを作成(アクセスする際には、<code>https://owlinux1000.github.io/blog/</code>) して、GitHubの設定で <strong>masterブランチのdocs/</strong> を公開対象として設定する。</p></li>

<li><p><code>config.toml</code> を編集する際には、<code>publishDir = &quot;docs&quot;</code> を追加しておく。これはGitHub 側で公開するディレクトリを<code>docs</code> にしているから。</p></li>
</ul>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4">$ brew install hugo
$ hugo new site blog
$ cd blog
$ git init
$ cd themes
$ git submodule add https://github.com/resugary/hugo-theme-one one
$ cp one/exampleSite/config.toml ../../../
$ emacs config.toml # 適宜パラメータを修正する</pre></div>
<h2 id="2-記事作成">2. 記事作成</h2>

<ul>
<li>hugo コマンドで記事を作成してまずは、server サブコマンドを使ってPreview を見てみる。大丈夫そうならGitHub にpushする</li>
</ul>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ hugo new posts/helloworld <span style="color:#408080;font-style:italic"># この記事</span>
$ emacs content/posts/helloworld.md <span style="color:#408080;font-style:italic"># draft: false に変更</span>
$ hugo <span style="color:#408080;font-style:italic"># Webページを生成。これでdocsに吐かれる</span>
$ hugo server <span style="color:#408080;font-style:italic"># アクセスして見れるか確認する</span>
$ git add .
$ git commit -m <span style="color:#ba2121">&#34;1st commit!&#34;</span>
$ git remote add origin git@github.com:owlinux1000/blog.git
$ git push -u origin master</code></pre></div>
<h2 id="おわりに">おわりに</h2>

<ul>
<li>Hugo を初めて使ってみた感想として結構めんどくさくなかったと思った。ネット上見てるとCIでがんばったりいろいろ見ていたので、プロジェクトサイトでのデプロイにした。毎月1本程度では継続していきたい。</li>
</ul>

  
</article>




      </div>
    </div>
  </main>
  
<footer class="Footer">
  <div class="u-wrapper">
    <div class="u-padding">
      Except where otherwise noted, content on this site is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license"> Creative Commons Attribution 4.0 International License</a>.
    </div>
  </div>
</footer>

  
</body>
</html>